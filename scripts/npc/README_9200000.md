# Quest Tracker NPC (ID: 9200000)

A comprehensive NPC script that tracks and summarizes all active quest objectives for players, with special GM functionality for server administrators.

## Features

### For All Players
- **Quest Summary**: Displays all active quests and their current progress
- **Item Collection Tracking**: Shows items needed for quests with current inventory counts
- **Mob Hunting Tracking**: Lists monsters to hunt with required quantities
- **NPC Talk Tracking**: Shows NPCs to talk to for quest completion
- **Script Quest Detection**: Identifies script-based quests that need manual NPC interaction
- **Smart Aggregation**: Combines requirements from multiple quests intelligently
- **Location Information**: Shows where NPCs are located (when data is available)

### For GMs (Game Masters)
- **Interactive Item Granting**: GMs can click on items in the quest summary to grant them to themselves
- **Interactive Mob Spawning**: GMs can click on mobs in the quest summary to spawn them nearby
- **Grant All Items**: GMs can grant all quest items at once with a single click
- **Spawn All Mobs**: GMs can spawn all quest mobs at once with a single click
- **Command Integration**: Uses @item and @spawn commands for proper server integration
- **Confirmation Dialogs**: Safety confirmations before executing GM actions
- **Visual Distinction**: GM mode has different formatting and interactive options

## Installation

1. Place the script file `9200000.js` in the `scripts/npc/` directory
2. Create an NPC with ID `9200000` in your database
3. (Optional) Create `scripts/npc_location.json` for NPC location data

### NPC Location Data (Optional)

Create a JSON file at `scripts/npc_location.json` with the following format:

```json
[
  {
    "name": "NPC Name",
    "location": "Town: Specific Location"
  }
]
```

This will enhance the NPC talk section with location information.

## Usage

### For Regular Players
1. Talk to the Quest Tracker NPC (ID: 9200000)
2. View your quest summary
3. Use the information to complete your quests

### For GMs
1. Talk to the Quest Tracker NPC (ID: 9200000)
2. If you have GM privileges, you'll see an interactive menu
3. Click on any item or mob option to perform GM actions:
   - **Items**: Click to grant the required quantity to yourself
   - **Mobs**: Click to spawn the required quantity near your location
   - **Grant All Items**: Click to grant all quest items at once
   - **Spawn All Mobs**: Click to spawn all quest mobs at once
4. Confirm the action when prompted

## GM Requirements

- GM Level 2 or higher for @item command
- GM Level 3 or higher for @spawn command
- The player must have the appropriate GM permissions

## Technical Details

### Quest Detection
- Scans quest IDs from 1000 to 30000
- Filters out medal quests (29000-29999 range and NPC 9000066)
- Supports both traditional quest methods and Quest.wz data parsing

### Data Sources
- **Quest.wz**: Primary source for quest requirements
- **String.wz**: NPC name resolution
- **ItemInformationProvider**: Item name and validation
- **MonsterInformationProvider**: Mob name resolution
- **Inventory System**: Current item counts

### GM Command Integration
- Uses `CommandsExecutor.getInstance().handle()` for proper command execution
- Supports @item and @spawn commands with proper parameters
- Includes error handling and user feedback

## Configuration

### Debug Mode
Set `DEBUG_MODE = true` at the top of the script to enable:
- Detailed quest processing information
- Quest ID listings
- Data source debugging
- Error reporting

### Quest Range
Modify the quest scanning range in the `generateQuestSummary()` function:
```javascript
for (var i = 1000; i <= 30000; i++) {
    // Quest scanning logic
}
```

## Limitations

1. **NPC Location Data**: Requires manual JSON file creation for location information
2. **Script Quests**: Cannot automatically determine requirements for script-based quests
3. **Quest Progress**: Some quest progress may not be accurately tracked for complex quests
4. **GM Permissions**: Requires proper GM level configuration for command execution
5. **Inventory Types**: Currently only checks ETC inventory for item counts

## Troubleshooting

### Common Issues

1. **"Unknown identifier: getQuests"**
   - This error occurs if the Character class doesn't have a public getQuests() method
   - The script uses `cm.getQuestStatus()` as a workaround

2. **GM commands not working**
   - Verify GM level permissions
   - Check that @item and @spawn commands are properly registered
   - Ensure the player has the required GM level

3. **Missing NPC locations**
   - Create the `scripts/npc_location.json` file
   - Ensure proper JSON formatting
   - Check file permissions

4. **Quest not showing up**
   - Verify quest ID is in the scanning range (1000-30000)
   - Check if quest is properly started (status = 1)
   - Enable debug mode for detailed information

### Debug Information

When debug mode is enabled, the script will show:
- Number of quests checked vs. found
- Active quest IDs
- Data source availability
- Processing errors

## Future Enhancements

- Support for more inventory types (EQUIP, USE, etc.)
- Enhanced NPC location database
- Quest progress tracking improvements
- Additional GM commands integration
- Quest completion automation for GMs
- Export functionality for quest data

## Version History

- **v1.0**: Initial release with basic quest tracking
- **v1.1**: Added GM functionality for item granting and mob spawning
- **v1.2**: Improved command execution using CommandsExecutor
- **v1.3**: Enhanced error handling and user feedback 